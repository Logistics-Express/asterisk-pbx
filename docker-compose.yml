version: '3.8'

services:
  asterisk:
    build: .
    container_name: logistics-asterisk
    hostname: pbx.logisticsexpress.es
    ports:
      - "5060:5060/udp"
      - "5060:5060/tcp"
      - "5061:5061/tcp"
      - "10000-10100:10000-10100/udp"
    environment:
      - TELEFACIL_SIP_USER=${TELEFACIL_SIP_USER}
      - TELEFACIL_SIP_PASSWORD=${TELEFACIL_SIP_PASSWORD}
      - OPENAI_PROJECT_ID=${OPENAI_PROJECT_ID}
      - OPENAI_API_KEY=${OPENAI_API_KEY}
      - JARVIS_API_URL=${JARVIS_API_URL:-https://jarvis.logisticsexpress.es}
    volumes:
      - ./asterisk:/etc/asterisk
      - asterisk-logs:/var/log/asterisk
      - asterisk-spool:/var/spool/asterisk
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "asterisk", "-rx", "core show version"]
      interval: 30s
      timeout: 10s
      retries: 3

volumes:
  asterisk-logs:
  asterisk-spool:
