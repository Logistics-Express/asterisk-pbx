; Jarvis Asterisk PJSIP Configuration
; Telefacil SIP Trunk + OpenAI Realtime SIP

;======================================
; TRANSPORT CONFIGURATION
;======================================

; UDP transport (Vultr IP: 208.85.18.221)
[transport-udp]
type=transport
protocol=udp
bind=0.0.0.0:5060
local_net=10.0.0.0/8
local_net=172.16.0.0/12
local_net=192.168.0.0/16
external_signaling_address=208.85.18.221
external_media_address=208.85.18.221

; TCP transport (Vultr IP: 208.85.18.221)
[transport-tcp]
type=transport
protocol=tcp
bind=0.0.0.0:5060
external_signaling_address=208.85.18.221
external_media_address=208.85.18.221

;======================================
; TELEFACIL SIP TRUNK (Inbound/Outbound)
;======================================

[telefacil]
type=registration
transport=transport-udp
outbound_auth=telefacil_auth
server_uri=sip:msip.duocom.es:5060
client_uri=sip:${TELEFACIL_SIP_USER}@msip.duocom.es
retry_interval=30
expiration=300
line=yes
endpoint=telefacil_endpoint

[telefacil_auth]
type=auth
auth_type=userpass
username=${TELEFACIL_SIP_USER}
password=${TELEFACIL_SIP_PASSWORD}

[telefacil_aor]
type=aor
contact=sip:msip.duocom.es:5060
qualify_frequency=30

[telefacil_endpoint]
type=endpoint
transport=transport-udp
context=from-telefacil
disallow=all
allow=alaw
allow=ulaw
aors=telefacil_aor
outbound_auth=telefacil_auth
from_user=${TELEFACIL_SIP_USER}
from_domain=msip.duocom.es
direct_media=no
force_rport=yes
rewrite_contact=yes
rtp_symmetric=yes

[telefacil_identify]
type=identify
endpoint=telefacil_endpoint
match=130.117.91.38

;======================================
; OPENAI REALTIME SIP TRUNK
;======================================
; OpenAI Realtime API SIP endpoint for AI voice processing
; Docs: https://platform.openai.com/docs/guides/realtime-sip

; TLS transport for OpenAI (required)
[transport-tls]
type=transport
protocol=tls
bind=0.0.0.0:5061
cert_file=/etc/asterisk/certs/asterisk.crt
priv_key_file=/etc/asterisk/certs/asterisk.key
method=tlsv1_2
verify_client=no
verify_server=no
external_signaling_address=208.85.18.221
external_media_address=208.85.18.221

; OpenAI Realtime endpoint
[openai_realtime]
type=endpoint
transport=transport-tls
context=to-openai
disallow=all
allow=ulaw
allow=alaw
aors=openai_aor
direct_media=no
force_rport=yes
rtp_symmetric=yes
dtmf_mode=rfc4733
ice_support=no
media_encryption=sdes
; OpenAI uses the project ID in the SIP URI for authentication
; The API key is sent via SIP headers by OpenAI

[openai_aor]
type=aor
contact=sip:${OPENAI_PROJECT_ID}@sip.api.openai.com:5061
qualify_frequency=0

;======================================
; DEFAULT CONTEXT
;======================================
; Calls from Telefacil will use from-telefacil context
